
## 프로젝트 생성

새 프로젝트를 만들고 Setup defults for 를 2D로 선택하면 2D 환경에서 시작할 수 있다.

### Assets 폴더

Assets 폴더에 Scenes, Scripts, Sprites 폴더를 생성한다.

### Sprites 이미지 만들기

스프라이트 이미지는
 - 완전 불투명 이미지: 캐릭터 배경이 비어 있는 이미지. BMP, PSD 
 - 투명한 이미지: 배경이 투명한 이미지. PNG, PSD 같이 투과색을 지원하는 파일
 - 알파 블랜드 이미지: 투명함을 단계별로 나타낸 이미지. PNG, PSD wjdnjs.

완전 불투명 이미지는 대부분 편집 프로그램에서 가능하다. 그러나 투명 이미지나 알파 블랜드 이미지는 알파 채널을 편집할 수 있는 프로그램만 가능하다. - Gimp, PHotoshop


#### 투명한 이미지

포토샵 등에서 배경색을 *Transparent* 하게 생성한다. 이미지를 작성하고 투명한 부분은 격자무늬로 표현도니다.


#### 알파 블랜드 이미지

알파 블랜드 이미지를 사용하면 캐릭터를 반투명한 유령처럼 보이게 할 수 있다. 또한 테두리선이 겹치는 부분이 anti-alias 로 테투리를 겹치면 배경의 경계선이 깨ㄷ끗해 진다.

> 벡터 드로잉 툴을 사용하면 자동으로 테두리가 앤티 앨리어스가 알파 채널의 투과색으로 표현된 비트맵을 얻을 수 있다.

알파 블랜드 이미지는

 - 포토샵에서 배경을 *White*로 주고 생성한다.
 - 새 레이어를 추가해 이곳에 이미지를 작성한다.
 - 작업중인 레이터에서 Add layer mask를 생성한다 - 유니티는 레이어 마스크를 인식.
 - 도구에서 Magic Wand Tool로 이미지만 선택한다.
 - 메뉴 Window / Channels 로 채널 뷰에서 Save Selection as channel 로 알파 채널을 추가해 준다.


#### 스프라이트 이밎 등록하기

이미지 파일을 Sprites 폴더로 끌여 놓으면 각 이미지는 Sprite import Settings 객체가 생성된다.

이제 에셋으로 등록한 스프라이트 이미지를 게임 오브젝트로 만들어 줄 수 있다. Sprites 폴더에 있는 스프라이트 이미지를 Herachy view에 드래드 하면 Scene view 중앙에 스프라이트 이미지가 게임 오브젝트로 추가된다.

이렇게 추가된 스프라이트 게임 오브젝트에서는 Tranform 과 Sprite Renderer component 가 포함되어 있다. 이 속성에서 주요한 속성을 살펴보자

#### Color 속성

Color 속성은 스프라이트 색을 줄 수 있는데, 알파 채널을 사용하는 스프라이트의 경우 흰색은 이미지 색을 그대로 표현하고, 다른 색을 추가하면 색이 적용된다. 속성에서 A 항목을 조절하면 알파 채널 값이 조절된다.

#### Sorting Layer 속성

스프라이트 이미지를 더 씬뷰에 추가해 보면 추가되는 순서데로 겹쳐서 보이는 것을 볼 수 있다. 이것은 2D 게임에서 스프라이트를 표시할 때 순서(전후 관계)가 주어지는데 매우 중요하다, 이것은 Transform 콤포넌트의 Position 속성의 Z 값을 바꿔서 사용할 수 있다. 

Z 값을 카메라와의 거리를 수정해서 표시 순서를 바꿔주는 역할을 한다. 이런 카메라 설정을 Orthographics (정사영.평행투영) 이라고 한다.

게임에서 카메라 설정을 Perspective 투시변환으로 변경해 Z 값만을 이용하면 문제가 생기는데, 스프라이트의 우선쉰위가 화면 끝에서 변환하기 때문이다.

그래서 스프라이트 표시 순서를 직접 설정하는 소팅 레이어를 활용해야 한다.

Sprite Renderere component 에서 Sorting layer를 추가해 준다.


#### Order in Layer 속성

스프라이트 표시 순서를 세밀하게 지정하려면 Order in Layer 를 사용한다. 같은 Sorting layer 라도 Order in layer 값이 큰 오브젝트가 화면 앞에 나타난다.

sorting layer 를 많이 만들면 관리하기 어렵다, 우선 순위를 조절할 때 order in layer 로 조정하는 것을 추천한다.

예를 들어 머리카락, 테두리, 눈, 코, 입 등 스프라이트를 '얼굴 레이어' 소팅 레이어로 정하고 order in layer 속성 값을 조절해 관리한다.

### 스테이지 만들기



### Camera component

2D 게임은 프로젝트를 2D로 구성하면 카메라가 2D에 맞게 투사 된다. 속성에서 Projection 형식을 Perspective로 하면 3D 카메라가 된다. 그리고 Projection을 Orthographic 으로 하면 2D 카메라가 된다.

2D 카메라도 중앙을 원점으로하는 왼손 좌표계를 사용한다. 좌표의 단위는 1x5이다.

Camera component의 속성

|  속성 이름     |         설명                |
| ---------------- | ------------------------------------------------------ |
| Clear Flags      | 랜더링시 화면 클리어 방식. 기본 Skybox. |
| Background       | 화면 클리어시 배경 색. 색과 알파 값 설정 |
| Culling Mask     | |




### Multiple mode

스프라이트를 하나씩 사요하면, 게임 실행시 draw call 이라는 랜더링 처리량이 늘어나 그래픽 표시가 느려질 수 있다. 개발자에 따라 스프라이트를 하나의 이미지에 배치해 사용할 수 있다.

한 파일에 여러 스프라이트를 포함하고 있으면 스프라이트 임포터에 Multiple mode를 사용한다.

#### Multiple mode 사용

스프라이트 이미지를 Assets 폴더에 추가하고, 이미지의 Inspector view에 Import Settings 의 Sprite Mode 항목에서 Multiple을 선택한다. 그리고 각 이미지를 하나씩의 스프라이트로 나누는 것은, Inspector view의 Sprite Editor 를 실행한다.

#### Sprite Editor

이미지 안의 여러 스프라이트를 드래그 해서 범위를 지정해 준다.

#### Slice

자동으로 이미지의 스프라이트를 잘라준다.


#### Atlas 아틀라스

이미지 파일 하나에 여러 스프라이트 이미지를 가진 포일을 아틀라스 혹은 스프라이트 시트라고 한다. 유니티는 타깃 플랫폼의 앱 메모리에 허용하는 범위에서 여러 아틀라스를 가질 수 있다.

단 플랫폼 마다 메모리에서 읽을 수 있는 아틀라스 한 장의 크기 (최대 텍스처 크기)가 정해져 있다.
 - 최신 아이폰/안드로이드: 2048 x 2048
 - 이전 : 1024x1024

이런 이미지 데이터의 크기는 GPU 칩 사양을 따르는데, 타깃 플랫폼에서 아틀라스 최대 크기를 확인할 수 있다. 프로젝트 브라우저에서 이미지를 선택해서 Inspector의 스프라이트 임포터에 아래 쪽에 Max sizeㄹ르 확인하거나 설정할 수 있다.

신제품의 GPU 사양은

www.glbenchmark.com 에서 확인할 수 있다.

스프라이트 이미지와 아틀라스 크기는 가로세로 모두 2제곱 크기로 정해주면 대부분 GPU가 스프라이트 이미지 크기가 2제곱일 때 빠르게 랜더링한다.
또한 아틀라스 이미지 데이터를 압축해서 메모리에 저장할 때 이미지 크기가 2제곱이 아니면 플랫폼 종류에 따라 이미지 데이터를 압축할 수 없다.

> 스프라이트 임포터에서 NPOT (Not Power of Two)가 나타나면 2제곱이 아니라는 것이다.
> 그래서 타깃 화면에 스프라이트 이미지가 깨져 보이면 아틀라스 이미지 크기가 2제곱인지 확인해야 한다.
> 2제곱을 제작할 수 없으면 최저 16배수로 제작하는 것을 권장한다.
> 아틀ㄹ라스 문제는 스마트폰 같은 기기에서 게임이 제대로 동작하지 않는 원인이 된다.
> 

#### 감색 문제

스프라이트 이미지를 가져올 때 컬러 포맷 (색의 수) 설정 문제가 있을 수 있다. 이미지가 그래디언트인 경우 임포트할 때 "Web play" 혹은 "PC, Mac & Linux" 플랫폼이면 문제가 없으나 아이폰, 안드로이드인 경우 노이으가 발생하거나 그래디언트 레벨이 망가지는 마하밴드 현상이 나타날 수 있다.
유니티에서 "Web play" 혹은 "PC, Mac & Linux" 플랫폼은 스프라이트 이미지가 풀 칼라라고 가정하지만 모바일의 경우 기본 임포터 설정이 16비트 컬라라서 자동으로 이미지를 압축하거나 감색하게 된다.

이 문제를 해결하기 위해서

##### 임포터 기본 포맷을 True color

스프라이트 임포터의 Format 속성을 Truecolor로 해준다.

##### 고품질 파일 형식 사용

에디터에서 고품질 파일 형식을 사용하는데 16비트 컬러이며 투과색과 알파 채널을 지원하는 포맷은 없다.
 - PSD
 - PSD index color
 - PNG-8
 - PNG-24
 - PNG-32
 - TGA

그래서 좋은 품질의 자동감색 도구 등으로 마하밴드가 발생하지 않게 감색하고 PNG로 저장한다 - 유료 통합 스프라이트 도구인 OPTix imesta 7, Texutre packer 등 이용.

##### 16비트 컬러 이미지

16비트 컬러 이미지로 일러스트레이터로 그린 그림을 가져온다. 가까운 색을 사용해 디더링 처리고 그림을 그리고 색을 16비트로 제한해 그래디언트 처리한다.

